<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<style type="text/css">
@font-face {
font-family: octicons-link;
src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}
body {
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
color: #333;
font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
font-size: 16px;
line-height: 1.6;
word-wrap: break-word;
}
a {
background-color: transparent;
}
a:active,
a:hover {
outline: 0;
}
strong {
font-weight: bold;
}
h1 {
font-size: 2em;
margin: 0.67em 0;
}
img {
border: 0;
}
hr {
box-sizing: content-box;
height: 0;
}
pre {
overflow: auto;
}
code,
kbd,
pre {
font-family: monospace, monospace;
font-size: 1em;
}
input {
color: inherit;
font: inherit;
margin: 0;
}
html input[disabled] {
cursor: default;
}
input {
line-height: normal;
}
input[type="checkbox"] {
box-sizing: border-box;
padding: 0;
}
table {
border-collapse: collapse;
border-spacing: 0;
}
td,
th {
padding: 0;
}
* {
box-sizing: border-box;
}
input {
font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
a {
color: #4078c0;
text-decoration: none;
}
a:hover,
a:active {
text-decoration: underline;
}
hr {
height: 0;
margin: 15px 0;
overflow: hidden;
background: transparent;
border: 0;
border-bottom: 1px solid #ddd;
}
hr:before {
display: table;
content: "";
}
hr:after {
display: table;
clear: both;
content: "";
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 15px;
margin-bottom: 15px;
line-height: 1.1;
}
h1 {
font-size: 30px;
}
h2 {
font-size: 21px;
}
h3 {
font-size: 16px;
}
h4 {
font-size: 14px;
}
h5 {
font-size: 12px;
}
h6 {
font-size: 11px;
}
blockquote {
margin: 0;
}
ul,
ol {
padding: 0;
margin-top: 0;
margin-bottom: 0;
}
ol ol,
ul ol {
list-style-type: lower-roman;
}
ul ul ol,
ul ol ol,
ol ul ol,
ol ol ol {
list-style-type: lower-alpha;
}
dd {
margin-left: 0;
}
code {
font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
font-size: 12px;
}
pre {
margin-top: 0;
margin-bottom: 0;
font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}
.select::-ms-expand {
opacity: 0;
}
.octicon {
font: normal normal normal 16px/1 octicons-link;
display: inline-block;
text-decoration: none;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.octicon-link:before {
content: '\f05c';
}
.markdown-body:before {
display: table;
content: "";
}
.markdown-body:after {
display: table;
clear: both;
content: "";
}
.markdown-body>*:first-child {
margin-top: 0 !important;
}
.markdown-body>*:last-child {
margin-bottom: 0 !important;
}
a:not([href]) {
color: inherit;
text-decoration: none;
}
.anchor {
display: inline-block;
padding-right: 2px;
margin-left: -18px;
}
.anchor:focus {
outline: none;
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 1em;
margin-bottom: 16px;
font-weight: bold;
line-height: 1.4;
}
h1 .octicon-link,
h2 .octicon-link,
h3 .octicon-link,
h4 .octicon-link,
h5 .octicon-link,
h6 .octicon-link {
color: #000;
vertical-align: middle;
visibility: hidden;
}
h1:hover .anchor,
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor {
text-decoration: none;
}
h1:hover .anchor .octicon-link,
h2:hover .anchor .octicon-link,
h3:hover .anchor .octicon-link,
h4:hover .anchor .octicon-link,
h5:hover .anchor .octicon-link,
h6:hover .anchor .octicon-link {
visibility: visible;
}
h1 {
padding-bottom: 0.3em;
font-size: 2.25em;
line-height: 1.2;
border-bottom: 1px solid #eee;
}
h1 .anchor {
line-height: 1;
}
h2 {
padding-bottom: 0.3em;
font-size: 1.75em;
line-height: 1.225;
border-bottom: 1px solid #eee;
}
h2 .anchor {
line-height: 1;
}
h3 {
font-size: 1.5em;
line-height: 1.43;
}
h3 .anchor {
line-height: 1.2;
}
h4 {
font-size: 1.25em;
}
h4 .anchor {
line-height: 1.2;
}
h5 {
font-size: 1em;
}
h5 .anchor {
line-height: 1.1;
}
h6 {
font-size: 1em;
color: #777;
}
h6 .anchor {
line-height: 1.1;
}
p,
blockquote,
ul,
ol,
dl,
table,
pre {
margin-top: 0;
margin-bottom: 16px;
}
hr {
height: 4px;
padding: 0;
margin: 16px 0;
background-color: #e7e7e7;
border: 0 none;
}
ul,
ol {
padding-left: 2em;
}
ul ul,
ul ol,
ol ol,
ol ul {
margin-top: 0;
margin-bottom: 0;
}
li>p {
margin-top: 16px;
}
dl {
padding: 0;
}
dl dt {
padding: 0;
margin-top: 16px;
font-size: 1em;
font-style: italic;
font-weight: bold;
}
dl dd {
padding: 0 16px;
margin-bottom: 16px;
}
blockquote {
padding: 0 15px;
color: #777;
border-left: 4px solid #ddd;
}
blockquote>:first-child {
margin-top: 0;
}
blockquote>:last-child {
margin-bottom: 0;
}
table {
display: block;
width: 100%;
overflow: auto;
word-break: normal;
word-break: keep-all;
}
table th {
font-weight: bold;
}
table th,
table td {
padding: 6px 13px;
border: 1px solid #ddd;
}
table tr {
background-color: #fff;
border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
background-color: #f8f8f8;
}
img {
max-width: 100%;
box-sizing: content-box;
background-color: #fff;
}
code {
padding: 0;
padding-top: 0.2em;
padding-bottom: 0.2em;
margin: 0;
font-size: 85%;
background-color: rgba(0,0,0,0.04);
border-radius: 3px;
}
code:before,
code:after {
letter-spacing: -0.2em;
content: "\00a0";
}
pre>code {
padding: 0;
margin: 0;
font-size: 100%;
word-break: normal;
white-space: pre;
background: transparent;
border: 0;
}
.highlight {
margin-bottom: 16px;
}
.highlight pre,
pre {
padding: 16px;
overflow: auto;
font-size: 85%;
line-height: 1.45;
background-color: #f7f7f7;
border-radius: 3px;
}
.highlight pre {
margin-bottom: 0;
word-break: normal;
}
pre {
word-wrap: normal;
}
pre code {
display: inline;
max-width: initial;
padding: 0;
margin: 0;
overflow: initial;
line-height: inherit;
word-wrap: normal;
background-color: transparent;
border: 0;
}
pre code:before,
pre code:after {
content: normal;
}
kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.pl-c {
color: #969896;
}
.pl-c1,
.pl-s .pl-v {
color: #0086b3;
}
.pl-e,
.pl-en {
color: #795da3;
}
.pl-s .pl-s1,
.pl-smi {
color: #333;
}
.pl-ent {
color: #63a35c;
}
.pl-k {
color: #a71d5d;
}
.pl-pds,
.pl-s,
.pl-s .pl-pse .pl-s1,
.pl-sr,
.pl-sr .pl-cce,
.pl-sr .pl-sra,
.pl-sr .pl-sre {
color: #183691;
}
.pl-v {
color: #ed6a43;
}
.pl-id {
color: #b52a1d;
}
.pl-ii {
background-color: #b52a1d;
color: #f8f8f8;
}
.pl-sr .pl-cce {
color: #63a35c;
font-weight: bold;
}
.pl-ml {
color: #693a17;
}
.pl-mh,
.pl-mh .pl-en,
.pl-ms {
color: #1d3e81;
font-weight: bold;
}
.pl-mq {
color: #008080;
}
.pl-mi {
color: #333;
font-style: italic;
}
.pl-mb {
color: #333;
font-weight: bold;
}
.pl-md {
background-color: #ffecec;
color: #bd2c00;
}
.pl-mi1 {
background-color: #eaffea;
color: #55a532;
}
.pl-mdr {
color: #795da3;
font-weight: bold;
}
.pl-mo {
color: #1d3e81;
}
kbd {
display: inline-block;
padding: 3px 5px;
font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.task-list-item {
list-style-type: none;
}
.task-list-item+.task-list-item {
margin-top: 3px;
}
.task-list-item input {
margin: 0 0.35em 0.25em -1.6em;
vertical-align: middle;
}
:checked+.radio-label {
z-index: 1;
position: relative;
border-color: #4078c0;
}
.sourceLine {
display: inline-block;
}
code .kw { color: #000000; }
code .dt { color: #ed6a43; }
code .dv { color: #009999; }
code .bn { color: #009999; }
code .fl { color: #009999; }
code .ch { color: #009999; }
code .st { color: #183691; }
code .co { color: #969896; }
code .ot { color: #0086b3; }
code .al { color: #a61717; }
code .fu { color: #63a35c; }
code .er { color: #a61717; background-color: #e3d2d2; }
code .wa { color: #000000; }
code .cn { color: #008080; }
code .sc { color: #008080; }
code .vs { color: #183691; }
code .ss { color: #183691; }
code .im { color: #000000; }
code .va {color: #008080; }
code .cf { color: #000000; }
code .op { color: #000000; }
code .bu { color: #000000; }
code .ex { color: #000000; }
code .pp { color: #999999; }
code .at { color: #008080; }
code .do { color: #969896; }
code .an { color: #008080; }
code .cv { color: #008080; }
code .in { color: #008080; }
</style>
<style>
body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 45px;
  padding-top: 0px;
}
</style>

</head>

<body>

<!-- README.md is generated from README.Rmd. Please edit that file -->

<h1 id="rbduk">Rbduk</h1>
<!-- badges: start -->

<!-- badges: end -->

<p>The goal of Rbduk is to provide BDUK analysts with a centralised set of repeatable functions for BDUK-specific R work.</p>
<p>For full doccumentations of all functions in the package please read the <a href="https://source.cloud.google.com/dcms-datalake-staging/Rbduk/+/master:vignettes/Vignette.md">vignette</a>.</p>
<h2 id="installation">Installation</h2>
<p>Ordinarily, a package would be installed either from a communal file store, or from a git repository. As our VM’s do not connect to the T:// drive that we share, and packages cannot be installed from a Google Source Repository, we have to do this manually:</p>
<ol>
<li>Within your VM, go to the ‘Files’ pane (next to ‘Plots’,‘Packages’, etc) and navigate to to the home directory by clicking the house symbol.!</li>
<li>Within the same pane, click the upload button.</li>
<li>Select “Choose File”, navigate to the T:// drive, and select the file <strong>Rbduk.tar.gz</strong>. If you do not have access to the T:// drive, visit it is also stored on the <a href="https://drive.google.com/drive/folders/1N760JFNMWoFAmhH3ivhkyrrYx882t2E5">Data and Modelling team’s google drive</a>. Download the file to your computer from here, and upload in the same fashion.</li>
<li>Within the console pane, enter <code>install.packages(&quot;dplyr&quot;,&quot;stringr&quot;,&quot;grid&quot;,&quot;ggplot2&quot;,&quot;bigrquery&quot;,&quot;geojsonsf&quot;,&quot;sf&quot;,&quot;shinyBS&quot;)</code> to install the packages dependencies.</li>
<li>Open the terminal tab (next to the console tab) within Rstudio.</li>
<li>Type <code>cd /home/dcms</code> and press enter.</li>
<li>Type <code>R CMD INSTALL Rbduk.tar.gz</code> and press enter.</li>
</ol>
<p>The package should now be installed, and to load it use <code>library(Rbduk)</code> as you would any other package.</p>
<p>For any additional support, to contribute, or to suggest things you would like to see, please contact <a href="sam.atkin@dcms.gov.uk">sam.atkin@dcms.gov.uk</a>.</p>
<p><strong>Do not push any code into the repository unless it has been quality assured first.</strong></p>
<h2 id="general-functions">General functions</h2>
<h3 id="is_integer64()">is_integer64()</h3>
<p>Within GCP, large numbers (eg UPRNs) are stored are 64-bit integers. R, on the whole, does not like 64-bit integer, and whilst it can cope, it’s easier to read in these columns are numeric, or convert them to numeric within R. To see if an object is currently a 64-bit integer, this function can be used.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">is_integer64</span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">is_integer64</span>(<span class="st">&quot;x&quot;</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<h3 id="pretty_postcode()">pretty_postcode()</h3>
<p>This function takes a postcode in any format and any case, and converts it into pretty format XX(X)(X)(Y)XXX, where X is the postcode, and Y is the specified seperator, which is a space by default. The case can also be specified, and is upper case by default.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">pretty_postcode</span>(<span class="st">&quot;SW1a2nP&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; [1] &quot;SW1A 2NP&quot;</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">pretty_postcode</span>(<span class="st">&quot;SW1a2nP&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; [1] &quot;SW1A2NP&quot;</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="kw">pretty_postcode</span>(<span class="st">&quot;SW1a2nP&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;.&quot;</span>)</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; [1] &quot;SW1A.2NP&quot;</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="kw">pretty_postcode</span>(<span class="st">&quot;SW1a2nP&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;.&quot;</span>, <span class="dt">uppercase=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; [1] &quot;sw1a.2np&quot;</span></a></code></pre></div>
<h3 id="is_postcode()">is_postcode()</h3>
<p>This function takes a string and returns TRUE or FALSE depedent on whether the string is in a valid UK postcode format or not. This may contain one space and still be valid. This does not indicate whether a postcode is an existing postcode, but that is has the format of one.</p>
<p>The following demonstrates valid postcodes and invalid postcodes:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">is_postcode</span>(<span class="st">&quot;SW1a2nP&quot;</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="kw">is_postcode</span>(<span class="st">&quot;SW1a 2nP&quot;</span>)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">#Too short</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">is_postcode</span>(<span class="st">&quot;S 2NP&quot;</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#Contains punctuation</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="kw">is_postcode</span>(<span class="st">&quot;Sw1a.2np&quot;</span>)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#Too long</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="kw">is_postcode</span>(<span class="st">&quot;Sw1a2npX&quot;</span>)</a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#Contains too many spaces</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="kw">is_postcode</span>(<span class="st">&quot;Sw1a  2np&quot;</span>)</a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#Not valid number/letter combiantion</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="kw">is_postcode</span>(<span class="st">&quot;000000&quot;</span>)</a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co">#Not valid number/letter combiantion</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="kw">is_postcode</span>(<span class="st">&quot;XXXXXX&quot;</span>)</a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<h3 id="is_uprn()">is_uprn()</h3>
<p>This function takes a numeric or character vector and returns TRUE or FALSE depedent on whether it is in a valid UPRN format (all numeric, between 1 and 12 characters). It will also flag as a message any UPRNs that end 0000, as a common conversion error caused by scientific notation and reading/writing from excel can cause genuine UPRNs to end in a number of zeros, meaning they are no longer genuine. One or two of these messages is acceptable, but many indicates that this error has occured and that the UPRNs should be checked thoroughly.</p>
<p>The following demonstrates valid and invalid UPRNs:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">is_uprn</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw">is_uprn</span>(<span class="dv">999999999999</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="kw">is_uprn</span>(<span class="st">&quot;1&quot;</span>)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="kw">is_uprn</span>(<span class="st">&quot;999999999999&quot;</span>)</a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">#Too long</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">is_uprn</span>(<span class="dv">9999999999999</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#Too long</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="kw">is_uprn</span>(<span class="st">&quot;9999999999999&quot;</span>)</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#Empty</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="kw">is_uprn</span>(<span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#Letters</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="kw">is_uprn</span>(<span class="st">&quot;ABC&quot;</span>)</a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="co">#Contains trailing characters</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="kw">is_uprn</span>(<span class="st">&quot;1,&quot;</span>)</a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="co">#Not an integer</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22"><span class="kw">is_uprn</span>(<span class="fl">111.999</span>)</a>
<a class="sourceLine" id="cb6-23" data-line-number="23"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24"></a>
<a class="sourceLine" id="cb6-25" data-line-number="25"><span class="co">#Not an integer</span></a>
<a class="sourceLine" id="cb6-26" data-line-number="26"><span class="kw">is_uprn</span>(<span class="st">&quot;111.999&quot;</span>)</a>
<a class="sourceLine" id="cb6-27" data-line-number="27"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb6-28" data-line-number="28"></a>
<a class="sourceLine" id="cb6-29" data-line-number="29"><span class="co">#Contains punctuation</span></a>
<a class="sourceLine" id="cb6-30" data-line-number="30"><span class="kw">is_uprn</span>(<span class="st">&quot;111-999&quot;</span>)</a>
<a class="sourceLine" id="cb6-31" data-line-number="31"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb6-32" data-line-number="32"></a>
<a class="sourceLine" id="cb6-33" data-line-number="33"><span class="co">#Contains punctuation</span></a>
<a class="sourceLine" id="cb6-34" data-line-number="34"><span class="kw">is_uprn</span>(<span class="st">&quot;111 999&quot;</span>)</a>
<a class="sourceLine" id="cb6-35" data-line-number="35"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<h3 id="%notin%-and-%!in%">%notin% and %!in%</h3>
<p>These functions serve the same purpose, and that is to give a more readable version of the opposite of <code>%in%</code>. They output the opposite logical response that <code>%in%</code> would provide.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="dv">2</span> <span class="op">%!in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="dv">2</span> <span class="op">%notin%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="st">&quot;b&quot;</span> <span class="op">%!in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;c&quot;</span>)</a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="st">&quot;b&quot;</span> <span class="op">%notin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;c&quot;</span>)</a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="dv">2</span> <span class="op">%!in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="dv">2</span> <span class="op">%notin%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="st">&quot;b&quot;</span> <span class="op">%!in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;b&quot;</span>,<span class="st">&quot;c&quot;</span>)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="st">&quot;b&quot;</span> <span class="op">%notin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;b&quot;</span>,<span class="st">&quot;c&quot;</span>)</a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">all.equal</span>(<span class="dv">2</span> <span class="op">%!in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="dv">2</span> <span class="op">%notin%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="op">!</span><span class="dv">2</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="kw">all.equal</span>(<span class="st">&quot;b&quot;</span> <span class="op">%!in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;c&quot;</span>), <span class="st">&quot;b&quot;</span> <span class="op">%notin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;c&quot;</span>), <span class="op">!</span><span class="st">&quot;b&quot;</span> <span class="op">%!in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;c&quot;</span>))</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<h2 id="gcp-functions">GCP functions</h2>
<h3 id="bduk_bq()">bduk_bq()</h3>
<p>THis function provides a shorthand for writing queries directly to bigquery within R. The input to this function must be a valid query, and the name of the project you are quering from within GCP. To run such a query a .json billing key must be stored on your machine. By default, this function will assume the key is the project name with &quot;_bigquery.json&quot; at the end. If this is not the case, the key name will need to be specified. By default, this function will assume the key is stored in the current working directory or project. If this is not the case, the key must be specified. This function also sets ‘bigint’ to integer64, allowing R to load in integer64 numbers (eg. UPRNs), but it is recommended that you use ‘CAST(VARIABLE as NUMERIC) as VARIABLE’ when running your queries, or converting these to numeric once they have been read in.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">sql=<span class="st">&quot;SELECT pcds,Rurality FROM `dcms-datalake-staging.GEO_ONS.ONS_RURALITY` LIMIT 1 &quot;</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw">setwd</span>(<span class="st">&quot;/home/dcms/keys&quot;</span>)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw">bduk_bq</span>(</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">      <span class="dt">sql=</span>sql,</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">      <span class="dt">project=</span><span class="st">&quot;dcms-datalake-staging&quot;</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8">    )</a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; Complete</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; Billed: 0 B</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; Downloading 1 rows in 1 pages.</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; Parsing [=======================================================================================================================] ETA:  0s                                                                                                                                          </span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; # A tibble: 1 x 2</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt;   pcds  Rurality</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;   </span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt; 1 pcds  Rurality</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="kw">bduk_bq</span>(</a>
<a class="sourceLine" id="cb10-19" data-line-number="19">      <span class="dt">sql=</span>sql,</a>
<a class="sourceLine" id="cb10-20" data-line-number="20">      <span class="dt">project=</span><span class="st">&quot;dcms-datalake-staging&quot;</span>,</a>
<a class="sourceLine" id="cb10-21" data-line-number="21">      <span class="dt">key=</span><span class="st">&quot;dcms-datalake-staging_bigquery.json&quot;</span></a>
<a class="sourceLine" id="cb10-22" data-line-number="22">    )</a>
<a class="sourceLine" id="cb10-23" data-line-number="23"><span class="co">#&gt; Complete</span></a>
<a class="sourceLine" id="cb10-24" data-line-number="24"><span class="co">#&gt; Billed: 0 B</span></a>
<a class="sourceLine" id="cb10-25" data-line-number="25"><span class="co">#&gt; Downloading 1 rows in 1 pages.</span></a>
<a class="sourceLine" id="cb10-26" data-line-number="26"><span class="co">#&gt; Parsing [=======================================================================================================================] ETA:  0s                                                                                                                                          </span></a>
<a class="sourceLine" id="cb10-27" data-line-number="27"><span class="co">#&gt; # A tibble: 1 x 2</span></a>
<a class="sourceLine" id="cb10-28" data-line-number="28"><span class="co">#&gt;   pcds  Rurality</span></a>
<a class="sourceLine" id="cb10-29" data-line-number="29"><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;   </span></a>
<a class="sourceLine" id="cb10-30" data-line-number="30"><span class="co">#&gt; 1 pcds  Rurality</span></a>
<a class="sourceLine" id="cb10-31" data-line-number="31"></a>
<a class="sourceLine" id="cb10-32" data-line-number="32"><span class="kw">bduk_bq</span>(</a>
<a class="sourceLine" id="cb10-33" data-line-number="33">      <span class="dt">sql=</span>sql,</a>
<a class="sourceLine" id="cb10-34" data-line-number="34">      <span class="dt">project=</span><span class="st">&quot;dcms-datalake-staging&quot;</span>,</a>
<a class="sourceLine" id="cb10-35" data-line-number="35">      <span class="dt">keypath=</span><span class="st">&quot;/home/dcms/keys&quot;</span></a>
<a class="sourceLine" id="cb10-36" data-line-number="36">    )</a>
<a class="sourceLine" id="cb10-37" data-line-number="37"><span class="co">#&gt; Complete</span></a>
<a class="sourceLine" id="cb10-38" data-line-number="38"><span class="co">#&gt; Billed: 0 B</span></a>
<a class="sourceLine" id="cb10-39" data-line-number="39"><span class="co">#&gt; Downloading 1 rows in 1 pages.</span></a>
<a class="sourceLine" id="cb10-40" data-line-number="40"><span class="co">#&gt; Parsing [=======================================================================================================================] ETA:  0s                                                                                                                                          </span></a>
<a class="sourceLine" id="cb10-41" data-line-number="41"><span class="co">#&gt; # A tibble: 1 x 2</span></a>
<a class="sourceLine" id="cb10-42" data-line-number="42"><span class="co">#&gt;   pcds  Rurality</span></a>
<a class="sourceLine" id="cb10-43" data-line-number="43"><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;   </span></a>
<a class="sourceLine" id="cb10-44" data-line-number="44"><span class="co">#&gt; 1 pcds  Rurality</span></a></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">sql=<span class="st">&quot;SELECT pcds,Rurality FROM `dcms-datalake-staging.GEO_ONS.ONS_RURALITY` LIMIT 1 &quot;</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#No key in this directory</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="kw">setwd</span>(<span class="st">&quot;/home/dcms/&quot;</span>)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="kw">bduk_bq</span>(</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">      <span class="dt">sql=</span>sql,</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">      <span class="dt">project=</span><span class="st">&quot;dcms-datalake-staging&quot;</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9">    )</a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt; There is no json key saved in this directory. Please copy the file 'dcms-datalake-staging_bigquery.json' into the project or directory you are working within. The file can likely be found in ~/home/keys. If you have not made this folder, please contact the BDUK data and modelling team for additional support.</span></a></code></pre></div>
<h2 id="spatial-functions">Spatial functions</h2>
<h3 id="geojson_to_sf()">geojson_to_sf()</h3>
<p>Data in BigQuery is frequently stored in geojson format. This function provides a cimple shorthand to input a data frame or tibble that contains a geojson column (eg. a table read from BigQuery) as easily convert it to a simple feature. The inputs to this function are the data frame or tibble, and the column name of the geojson column as a string.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">bq_table&lt;-<span class="kw">bduk_bq</span>(</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">          <span class="dt">sql=</span><span class="st">&quot;SELECT * FROM dcms-datalake-staging.GEO_ONS.shp_LA LIMIT 1&quot;</span> ,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">          <span class="dt">project=</span><span class="st">&quot;dcms-datalake-staging&quot;</span>,</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">          <span class="dt">keypath=</span><span class="st">&quot;/home/dcms/keys&quot;</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt; Complete</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt; Billed: 0 B</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt; Downloading 1 rows in 1 pages.</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt; Parsing [=======================================================================================================================] ETA:  0s                                                                                                                                          </span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="kw">geojson_to_sf</span>(</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">        <span class="dt">data=</span>bq_table,</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">        <span class="dt">geojson_colname =</span> <span class="st">&quot;geom&quot;</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13">      )</a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">#&gt; Simple feature collection with 1 feature and 10 fields</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt; geometry type:  POLYGON</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">#&gt; dimension:      XY</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">#&gt; bbox:           xmin: 440052.7 ymin: 525456.8 xmax: 454455 ymax: 537152</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">#&gt; CRS:            4326</span></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"><span class="co">#&gt; Warning in st_is_longlat(x): bounding box has potentially an invalid value range for longlat data</span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"><span class="co">#&gt; # A tibble: 1 x 11</span></a>
<a class="sourceLine" id="cb12-21" data-line-number="21"><span class="co">#&gt;                                                     geom OBJECTID LAD20CD  LAD20NM  LAD20NMW  BNG_E  BNG_N  LONG   LAT Shape__Are Shape__Len</span></a>
<a class="sourceLine" id="cb12-22" data-line-number="22"><span class="co">#&gt;                                            &lt;POLYGON [°]&gt;  &lt;int64&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;int6&gt; &lt;int6&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb12-23" data-line-number="23"><span class="co">#&gt; 1 ((448973.6 536745.3, 448986 536729.7, 453194.6 533938…        1 E060000… Hartlep… &lt;NA&gt;     447160 531474 -1.27  54.7  96607269.     50738.</span></a></code></pre></div>
<h3 id="make_sf()">make_sf()</h3>
<p>This function provides an easy shorthand to take any dataframe with coordinate columns, and convert it into a simple feature object. The inputs to this function are the data frame or tibble, the x and y column names, both as strings, and the coordinate system number. Coordinate reference system codes can be found at <a href="https://spatialreference.org/">https://spatialreference.org/</a>. This mostly serves as a wrapped to sf::st_as_sf(), but the defaults for this are set as latitude and longitude. Columns containing the string “lon” or “lat” in any case being used as the x_colname and y_colname respectively, and the coordinate reference system set to 4326. If multiple columns contain these strings, the function will return the data frame unchanged and produce an error message prompting you to specify the column names manually.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">make_sf</span>(</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">       <span class="dt">data=</span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">          <span class="st">&quot;Longitude&quot;</span>=<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">          <span class="st">&quot;Latitude&quot;</span>=<span class="kw">c</span>(<span class="dv">51</span>,<span class="dv">52</span>,<span class="dv">53</span>)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">          ),</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">       <span class="dt">x_colname=</span><span class="st">&quot;Longitude&quot;</span>,</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">       <span class="dt">y_colname=</span><span class="st">&quot;Latitude&quot;</span>,</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">       <span class="dt">crs=</span><span class="dv">4326</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9">    )</a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt; Simple feature collection with 3 features and 0 fields</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co">#&gt; geometry type:  POINT</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co">#&gt; dimension:      XY</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#&gt; bbox:           xmin: 1 ymin: 51 xmax: 3 ymax: 53</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">#&gt; CRS:            EPSG:4326</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co">#&gt;       geometry</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co">#&gt; 1 POINT (1 51)</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">#&gt; 2 POINT (2 52)</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18"><span class="co">#&gt; 3 POINT (3 53)</span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="kw">make_sf</span>(</a>
<a class="sourceLine" id="cb13-21" data-line-number="21">       <span class="dt">data=</span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb13-22" data-line-number="22">          <span class="st">&quot;Longitude&quot;</span>=<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb13-23" data-line-number="23">          <span class="st">&quot;Latitude&quot;</span>=<span class="kw">c</span>(<span class="dv">51</span>,<span class="dv">52</span>,<span class="dv">53</span>)</a>
<a class="sourceLine" id="cb13-24" data-line-number="24">          )</a>
<a class="sourceLine" id="cb13-25" data-line-number="25">    )</a>
<a class="sourceLine" id="cb13-26" data-line-number="26"><span class="co">#&gt; Simple feature collection with 3 features and 0 fields</span></a>
<a class="sourceLine" id="cb13-27" data-line-number="27"><span class="co">#&gt; geometry type:  POINT</span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28"><span class="co">#&gt; dimension:      XY</span></a>
<a class="sourceLine" id="cb13-29" data-line-number="29"><span class="co">#&gt; bbox:           xmin: 1 ymin: 51 xmax: 3 ymax: 53</span></a>
<a class="sourceLine" id="cb13-30" data-line-number="30"><span class="co">#&gt; CRS:            EPSG:4326</span></a>
<a class="sourceLine" id="cb13-31" data-line-number="31"><span class="co">#&gt;       geometry</span></a>
<a class="sourceLine" id="cb13-32" data-line-number="32"><span class="co">#&gt; 1 POINT (1 51)</span></a>
<a class="sourceLine" id="cb13-33" data-line-number="33"><span class="co">#&gt; 2 POINT (2 52)</span></a>
<a class="sourceLine" id="cb13-34" data-line-number="34"><span class="co">#&gt; 3 POINT (3 53)</span></a>
<a class="sourceLine" id="cb13-35" data-line-number="35"></a>
<a class="sourceLine" id="cb13-36" data-line-number="36"><span class="kw">make_sf</span>(</a>
<a class="sourceLine" id="cb13-37" data-line-number="37">      <span class="dt">data=</span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb13-38" data-line-number="38">        <span class="st">&quot;Longitude_1&quot;</span>=<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb13-39" data-line-number="39">        <span class="st">&quot;Longitude_2&quot;</span>=<span class="kw">c</span>(<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">14</span>),</a>
<a class="sourceLine" id="cb13-40" data-line-number="40">        <span class="st">&quot;Latitude&quot;</span>=<span class="kw">c</span>(<span class="dv">51</span>,<span class="dv">52</span>,<span class="dv">53</span>)</a>
<a class="sourceLine" id="cb13-41" data-line-number="41">      )</a>
<a class="sourceLine" id="cb13-42" data-line-number="42">    )</a>
<a class="sourceLine" id="cb13-43" data-line-number="43"><span class="co">#&gt; Error: Multiple columns contain 'lon', please specify the x_colname.</span></a>
<a class="sourceLine" id="cb13-44" data-line-number="44"><span class="co">#&gt;   Longitude_1 Longitude_2 Latitude</span></a>
<a class="sourceLine" id="cb13-45" data-line-number="45"><span class="co">#&gt; 1           1          11       51</span></a>
<a class="sourceLine" id="cb13-46" data-line-number="46"><span class="co">#&gt; 2           2          12       52</span></a>
<a class="sourceLine" id="cb13-47" data-line-number="47"><span class="co">#&gt; 3           3          14       53</span></a></code></pre></div>
<h2 id="shiny-functions">Shiny functions</h2>
<h3 id="cleargroups()">clearGroups()</h3>
<p>A function to clear all groups from a leaflet object from within a shiny application. The prevents having to run <code>clearGroup(&quot;groupname&quot;)</code> for every group. The input to this is the name of the map, and then the groups wanting to be cleared as comma seperated strings.</p>
<pre><code>library(shiny)
library(leaflet)
library(dplyr)

points_1&lt;-data.frame(&quot;lng&quot;=c(-2,-1,0),&quot;lat&quot;=c(51,52,53))
points_2&lt;-data.frame(&quot;lng&quot;=c(-2.1,-1.1,-0.1),&quot;lat&quot;=c(51,52,53))

ui&lt;-fluidPage(
  fluidRow(
    actionButton(&quot;addgroups&quot;, &quot;Add Groups&quot;),
    actionButton(&quot;cleargroups&quot;, &quot;Clear Groups&quot;),
    leafletOutput(&quot;mymap&quot;)
  )
)

server&lt;-function(input,output,session){

  output$mymap &lt;- renderLeaflet({
    leaflet(options = leafletOptions(preferCanvas = TRUE)) %&gt;%
      addTiles(options = tileOptions(opacity = 0.8), group = &quot;Open Street Map&quot;) %&gt;%
      setView(lng = -1, lat = 52, zoom = 7)
  })

  observeEvent(input$addgroups,{
    leafletProxy(&quot;mymap&quot;)%&gt;%
      addCircles(data=points_1,lng=~lng,lat=~lat,color=&quot;Red&quot;,group=&quot;Group 1&quot;) %&gt;%
      addCircles(data=points_2,lng=~lng,lat=~lat,color=&quot;Blue&quot;,group=&quot;Group 2&quot;)
  })

  observeEvent(input$cleargroups,{
    clearGroups(map=&quot;mymap&quot;,&quot;Group 1&quot;,&quot;Group 2&quot;)
  })
}

shinyApp(ui, server)
</code></pre>
<h3 id="radiotooltip()">radioTooltip()</h3>
<p>By default, shiny and shinyBS together allow us to add popup tooltips to shiny buttons and input fields. However, this tooltip will apply to all parts of the input fiels. For radio buttons and groups of checkboxes, this can be problematic. This function allows us to add a tooltip to specific parts of a radio button.</p>
<pre><code>library(shiny)
library(leaflet)
library(dplyr)

ui&lt;-fluidPage(
  fluidRow(
    radioButtons(
      &quot;radio&quot;,
      &quot;Radio Button&quot;,
      choices=c(&quot;Tooltip shows on mouseover here&quot;,
                &quot;Tooltip shows on mouseover here as well&quot;,
                &quot;Tooltip does not show on mouseover here&quot;)
                ),
    radioTooltip(
      id=&quot;radio&quot;,
      title=&quot;Tooltip message appears like this&quot;,
      choice=c(
        &quot;Tooltip shows on mouseover here&quot;,
        &quot;Tooltip shows on mouseover here as well&quot;
      ),
      placement=&quot;right&quot;,
      trigger=&quot;hover&quot;
    )
  )
)

server&lt;-function(input,output,session){}

shinyApp(ui, server)
</code></pre>

</body>
</html>
